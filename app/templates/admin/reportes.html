{% extends 'admin/dashboard.html' %}

{% block titulo %}
  ADMIN | REPORTES
{% endblock %}

{% block formulario %}
<div class="layout-content-container flex flex-col max-w-[960px] w-[90%] mx-auto flex-1 bg-[#101828] rounded-xl shadow-lg mt-90">
  <div class="flex flex-wrap justify-between gap-3 p-4">
    <p class="tracking-light text-[32px] font-bold leading-tight min-w-72" style="color:#F0B000;">Filtros para el Reporte General</p>
  </div>
  <form method="post" class="w-full">
    <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
      <label class="flex flex-col min-w-40 flex-1">
        <p class="text-base font-medium leading-normal pb-2" style="color:#F0B000;">Usuario</p>
        <select
          name="usuario" id="usuario"
          class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl focus:outline-0 focus:ring-0 border border-[#7e6520] bg-[#101828] focus:border-[#F0B000] h-14 placeholder:text-[#dec47c] p-[15px] text-base font-normal leading-normal"
          style="color:#F0B000;"
        >
          <option value="">Seleccione un usuario</option>
          {% for usuario in usuarios %}
          <option value="{{ usuario }}" {% if usuario|string == filtros.usuario|string %}selected{% endif %}>{{ usuario }}</option>
          {% endfor %}
        </select>
      </label>
    </div>
    <div class="flex px-4 py-3">
      <div class="flex h-10 flex-1 items-center justify-start gap-6 rounded-full bg-[#232b3b] p-2">
        <label class="flex items-center gap-2 text-[#F0B000] text-sm font-medium leading-normal cursor-pointer">
          <input type="checkbox" name="ingreso" value="on"
            class="accent-[#F0B000] w-4 h-4 rounded focus:ring-0 border border-[#7e6520] bg-[#101828]"
            {% if filtros.ingreso %}checked{% endif %}>
          Ingreso
        </label>
        <label class="flex items-center gap-2 text-[#F0B000] text-sm font-medium leading-normal cursor-pointer">
          <input type="checkbox" name="egreso" value="on"
            class="accent-[#F0B000] w-4 h-4 rounded focus:ring-0 border border-[#7e6520] bg-[#101828]"
            {% if filtros.egreso %}checked{% endif %}>
          Egreso
        </label>
      </div>
    </div>
    <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
      <label class="flex flex-col min-w-40 flex-1">
        <p class="text-base font-medium leading-normal pb-2" style="color:#F0B000;">Fecha Inicio</p>
        <input
          type="date" id="fecha_inicio" name="fecha_inicio"
          class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl focus:outline-0 focus:ring-0 border border-[#7e6520] bg-[#101828] focus:border-[#F0B000] h-14 placeholder:text-[#dec47c] p-[15px] text-base font-normal leading-normal"
          style="color:#F0B000;"
          value="{{ filtros.fecha_inicio }}"
        />
      </label>
      <label class="flex flex-col min-w-40 flex-1">
        <p class="text-base font-medium leading-normal pb-2" style="color:#F0B000;">Fecha Final</p>
        <input
          type="date" id="fecha_final" name="fecha_final"
          class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl focus:outline-0 focus:ring-0 border border-[#7e6520] bg-[#101828] focus:border-[#F0B000] h-14 placeholder:text-[#dec47c] p-[15px] text-base font-normal leading-normal"
          style="color:#F0B000;"
          value="{{ filtros.fecha_final }}"
        />
      </label>
    </div>
    <div class="flex px-4 py-3 justify-start">
      <input
        type="submit"
        value="Filtrar"
        class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#F0B000] text-[#101828] text-sm font-bold leading-normal tracking-[0.015em]"
      />
    </div>
  </form>
</div>
{% endblock %}

{% block contenido %}
  <h1 class="text-[22px] font-bold leading-tight tracking-[-0.015em] px-4 text-left pb-3 pt-5" style="color:#F0B000;">Tabla de contenido de datos</h1>
  <div class="flex justify-stretch w-[90%] mx-auto">
    <div class="flex flex-1 gap-3 flex-wrap px-4 py-3 justify-start">
      <form method="post" action="{{ url_for('admin.exportar_excel') }}">
        <input type="hidden" name="usuario" value="{{ filtros.usuario }}">
        <input type="hidden" name="ingreso" value="{{ 'on' if filtros.ingreso else '' }}">
        <input type="hidden" name="egreso" value="{{ 'on' if filtros.egreso else '' }}">
        <input type="hidden" name="fecha_inicio" value="{{ filtros.fecha_inicio }}">
        <input type="hidden" name="fecha_final" value="{{ filtros.fecha_final }}">
        <button
          type="submit"
          class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#232b3b] text-[#F0B000] text-sm font-bold leading-normal tracking-[0.015em]"
        >
          <span class="truncate">Exportar a Excel</span>
        </button>
      </form>
    </div>
  </div>
  <div class="px-4 py-3 @container w-[90%] mx-auto">
    <div class="flex overflow-x-auto rounded-xl border border-[#7e6520] bg-[#101828] max-w-full">
      <table class="flex-1 w-full min-w-[800px]">
        <thead>
          <tr class="bg-[#232b3b]">
            <th class="px-4 py-3 text-left" style="color:#F0B000;">Fecha</th>
            <th class="px-4 py-3 text-left" style="color:#F0B000;">Usuario</th>
            <th class="px-4 py-3 text-left" style="color:#F0B000;">Tipo</th>
            <th class="px-4 py-3 text-left" style="color:#F0B000;">Descripci√≥n</th>
            <th class="px-4 py-3 text-left" style="color:#F0B000;">Cantidad</th>
            <th class="px-4 py-3 text-left" style="color:#F0B000;">Precio Unitario</th>
            <th class="px-4 py-3 text-left" style="color:#F0B000;">Precio Total</th>
          </tr>
        </thead>
        <tbody>
          {% for row in resultados %}
            <tr class="border-t border-t-[#7e6520]">
              <td class="h-[56px] px-4 py-2 text-[#F0B000] text-sm font-normal leading-normal">{{ row[0] }}</td>
              <td class="h-[56px] px-4 py-2 text-[#F0B000] text-sm font-normal leading-normal">{{ row[1] }}</td>
              <td class="h-[56px] px-4 py-2 text-[#F0B000] text-sm font-normal leading-normal">{{ row[2] }}</td>
              <td class="h-[56px] px-4 py-2 text-[#F0B000] text-sm font-normal leading-normal">{{ row[3] }}</td>
              <td class="h-[56px] px-4 py-2 text-[#F0B000] text-sm font-normal leading-normal">{{ row[4] }}</td>
              <td class="h-[56px] px-4 py-2 text-[#F0B000] text-sm font-normal leading-normal">{{ row[5] }}</td>
              <td class="h-[56px] px-4 py-2 text-[#F0B000] text-sm font-normal leading-normal">{{ row[6] }}</td>
            </tr>
          {% else %}
            <tr>
              <td colspan="7" class="px-4 py-2 text-center text-[#F0B000]">No hay datos para mostrar.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <style>
      @media (max-width: 900px) {
        table, thead, tbody, th, td, tr { display: block; }
        th, td { width: 100% !important; }
      }
    </style>
  </div>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/script-egreso.js') }}"></script>
{% endblock %}